{% extends 'base.html' %}
{% load static %}

{% block title %}Réinitialisation du mot de passe — LONAB MUTRALO{% endblock %}

{% block extra_css %}
<style>
  *, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
  body { background:#f0f4f1; min-height:100vh; }

  .auth-wrapper {
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    padding:24px 16px;
    background:radial-gradient(ellipse at top left,#e8f5ee 0%,#f0f4f1 50%,#e8f0ea 100%);
  }

  .auth-container {
    width:100%; max-width:900px;
    display:grid; grid-template-columns:1fr 1fr;
    background:#fff; border-radius:20px;
    box-shadow:0 20px 60px rgba(0,0,0,.12); overflow:hidden;
  }

  /* Illustration */
  .auth-illustration {
    background:linear-gradient(160deg,#1a3a2a 0%,#1e5c3a 50%,#2d7a50 100%);
    padding:48px 40px; display:flex; flex-direction:column; justify-content:center; position:relative; overflow:hidden;
  }
  .auth-illustration::before { content:''; position:absolute; top:-80px; right:-80px; width:250px; height:250px; background:rgba(255,255,255,.05); border-radius:50%; }
  .auth-illustration::after { content:''; position:absolute; bottom:-60px; left:-60px; width:200px; height:200px; background:rgba(255,255,255,.05); border-radius:50%; }
  .auth-logo { width:64px; height:64px; background:rgba(255,255,255,.15); border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:28px; color:#fff; margin-bottom:28px; position:relative; z-index:1; }
  .auth-illustration h1 { color:#fff; font-size:24px; font-weight:800; line-height:1.3; margin-bottom:10px; position:relative; z-index:1; }
  .auth-illustration p { color:rgba(255,255,255,.75); font-size:13px; line-height:1.7; position:relative; z-index:1; }

  /* Steps */
  .reset-steps { margin-top:36px; position:relative; z-index:1; }
  .reset-step { display:flex; gap:12px; align-items:flex-start; margin-bottom:16px; }
  .step-dot { width:24px; height:24px; background:rgba(255,255,255,.2); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:#fff; flex-shrink:0; margin-top:1px; }
  .step-content { color:rgba(255,255,255,.85); font-size:12px; line-height:1.5; }
  .step-content strong { color:#fff; }

  /* Form side */
  .auth-form-container { padding:48px 44px; display:flex; flex-direction:column; justify-content:center; }
  .auth-form-header { margin-bottom:28px; }
  .auth-form-header .icon-wrap { width:52px; height:52px; background:#e8f5ee; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:22px; color:#1e5c3a; margin-bottom:16px; }
  .auth-form-header h2 { font-size:22px; font-weight:800; color:#1a2332; margin-bottom:6px; }
  .auth-form-header p { font-size:14px; color:#6b7280; }

  .alert { padding:12px 16px; border-radius:10px; font-size:13px; margin-bottom:16px; display:flex; align-items:center; gap:10px; animation:fadeIn .3s ease; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:none} }
  .alert-error { background:#fee2e2; color:#991b1b; border:1px solid #fca5a5; }
  .alert-success { background:#d1fae5; color:#065f46; border:1px solid #6ee7b7; }

  .form-group { margin-bottom:18px; }
  .form-label { display:block; font-size:12px; font-weight:700; color:#374151; text-transform:uppercase; letter-spacing:.5px; margin-bottom:7px; }
  .input-icon-wrap { position:relative; }
  .input-icon { position:absolute; left:13px; top:50%; transform:translateY(-50%); color:#9ca3af; font-size:14px; }
  .input-icon-wrap .form-control { padding-left:38px; }
  .form-control { width:100%; padding:12px 14px; border:2px solid #e5e7eb; border-radius:10px; font-size:14px; color:#1a2332; background:#fff; transition:all .2s; font-family:inherit; }
  .form-control:focus { outline:none; border-color:#2d7a50; box-shadow:0 0 0 4px rgba(45,122,80,.12); }
  .form-control::placeholder { color:#9ca3af; }

  .auth-submit { width:100%; padding:13px; background:linear-gradient(135deg,#1e5c3a,#3a9e6a); color:#fff; border:none; border-radius:10px; font-size:15px; font-weight:700; cursor:pointer; transition:all .3s; display:flex; align-items:center; justify-content:center; gap:8px; box-shadow:0 4px 14px rgba(30,92,58,.3); }
  .auth-submit:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(30,92,58,.4); }
  .auth-submit:disabled { opacity:.7; cursor:not-allowed; transform:none; }

  .divider { display:flex; align-items:center; gap:14px; margin:22px 0; }
  .divider::before, .divider::after { content:''; flex:1; height:1px; background:#e5e7eb; }
  .divider span { font-size:12px; color:#9ca3af; font-weight:600; }

  .back-link { display:flex; align-items:center; justify-content:center; gap:7px; color:#2d7a50; font-size:14px; font-weight:600; text-decoration:none; padding:10px; border-radius:8px; transition:background .2s; }
  .back-link:hover { background:#f2faf5; }

  /* Success state */
  .success-state { text-align:center; padding:20px 0; }
  .success-icon { width:72px; height:72px; background:#d1fae5; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px; font-size:30px; color:#059669; }
  .success-title { font-size:20px; font-weight:800; color:#1a2332; margin-bottom:10px; }
  .success-text { font-size:14px; color:#6b7280; line-height:1.6; margin-bottom:24px; }

  @media (max-width:768px) {
    .auth-container { grid-template-columns:1fr; max-width:420px; }
    .auth-illustration { display:none; }
    .auth-form-container { padding:40px 32px; }
  }
  @media (max-width:400px) {
    .auth-form-container { padding:32px 24px; }
  }
</style>
{% endblock %}

{% block body %}
<div class="auth-wrapper">
  <div class="auth-container">

    <!-- Illustration -->
    <div class="auth-illustration">
      <div class="auth-logo"><i class="fas fa-key"></i></div>
      <h1>Mot de passe<br>oublié ?</h1>
      <p>Pas de souci ! Renseignez votre adresse email et nous vous enverrons les instructions de réinitialisation.</p>

      <div class="reset-steps">
        <div class="reset-step">
          <div class="step-dot">1</div>
          <div class="step-content"><strong>Saisissez votre email</strong><br>L'email associé à votre compte LONAB</div>
        </div>
        <div class="reset-step">
          <div class="step-dot">2</div>
          <div class="step-content"><strong>Vérifiez vos emails</strong><br>Un lien vous sera envoyé dans les minutes qui suivent</div>
        </div>
        <div class="reset-step">
          <div class="step-dot">3</div>
          <div class="step-content"><strong>Créez un nouveau mot de passe</strong><br>Choisissez un mot de passe sécurisé</div>
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="auth-form-container">

      {% if messages %}
      {% for message in messages %}
        {% if 'success' in message.tags %}
        <!-- Success state -->
        <div class="success-state">
          <div class="success-icon"><i class="fas fa-paper-plane"></i></div>
          <div class="success-title">Email envoyé !</div>
          <p class="success-text">
            Si un compte est associé à cette adresse email, vous recevrez un lien de réinitialisation dans les prochaines minutes.<br><br>
            <small>Vérifiez également vos spams si vous ne le trouvez pas.</small>
          </p>
          <a href="{% url 'accounts:login' %}" class="auth-submit" style="text-decoration:none;justify-content:center;">
            <i class="fas fa-sign-in-alt"></i> Retour à la connexion
          </a>
        </div>
        {% else %}
        <div class="alert alert-{{ message.tags }}">
          <i class="fas fa-exclamation-circle"></i>{{ message }}
        </div>
        {% endif %}
      {% endfor %}
      {% endif %}

      {% if not messages or messages|length == 0 %}
      <div class="auth-form-header">
        <div class="icon-wrap"><i class="fas fa-envelope"></i></div>
        <h2>Réinitialisation</h2>
        <p>Entrez votre email pour recevoir les instructions</p>
      </div>

      <form method="post" action="{% url 'accounts:password_reset' %}" id="resetForm">
        {% csrf_token %}

        <div class="form-group">
          <label class="form-label" for="email">Adresse email</label>
          <div class="input-icon-wrap">
            <i class="fas fa-envelope input-icon"></i>
            <input type="email" id="email" name="email" class="form-control"
              placeholder="votre.email@lonab.com" required autocomplete="email">
          </div>
        </div>

        <button type="submit" class="auth-submit" id="submitBtn">
          <i class="fas fa-paper-plane"></i>
          <span id="submitText">Envoyer le lien</span>
        </button>
      </form>

      <div class="divider"><span>ou</span></div>

      <a href="{% url 'accounts:login' %}" class="back-link">
        <i class="fas fa-arrow-left"></i> Retour à la connexion
      </a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('resetForm')?.addEventListener('submit', function() {
  const btn = document.getElementById('submitBtn');
  const text = document.getElementById('submitText');
  if (btn) { btn.disabled = true; text.textContent = 'Envoi en cours…'; }
});

document.querySelectorAll('.alert:not(.alert-success)').forEach(alert => {
  setTimeout(() => {
    alert.style.transition = 'opacity .4s';
    alert.style.opacity = '0';
    setTimeout(() => alert.remove(), 400);
  }, 5000);
});
</script>
{% endblock %}