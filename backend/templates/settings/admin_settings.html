{% extends 'dashboards/base_dashboard.html' %}
{% load static %}

{% block title %}Paramètres Système{% endblock %}
{% block dashboard_css %}
<link rel="stylesheet" href="{% static 'css/components.css' %}">
<style>
    .dc{background:#fff;border-radius:7px;box-shadow:0 1px 3px rgba(0,0,0,.07);overflow:hidden;margin-bottom:8px;}
    .dc-head{padding:8px 12px;border-bottom:1px solid #f3f4f6;display:flex;align-items:center;gap:6px;font-size:11px;font-weight:600;color:#374151;}
    .dc-head i{color:#28a745;font-size:10px;}
    .dc-body{padding:12px 16px;}
    .sg{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .sg3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
    .fl{display:block;font-size:10px;font-weight:600;color:#374151;margin-bottom:3px;}
    .fc{width:100%;padding:6px 8px;border:1px solid #e5e7eb;border-radius:5px;font-size:11px;color:#111827;outline:none;box-sizing:border-box;transition:border-color .15s;}
    .fc:focus{border-color:#28a745;box-shadow:0 0 0 2px rgba(40,167,69,.1);}
    .fh{font-size:9px;color:#9ca3af;margin-top:2px;}
    .tog-row{display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid #fafafa;}
    .tog-row:last-child{border-bottom:none;}
    .tog-l{font-size:11px;color:#374151;}
    .tog-s{font-size:9px;color:#9ca3af;margin-top:1px;}
    .tog{position:relative;width:32px;height:18px;flex-shrink:0;}
    .tog input{opacity:0;width:0;height:0;}
    .tog-sl{position:absolute;top:0;left:0;right:0;bottom:0;background:#d1d5db;border-radius:18px;cursor:pointer;transition:.2s;}
    .tog-sl:before{content:"";position:absolute;height:12px;width:12px;left:3px;bottom:3px;background:white;border-radius:50%;transition:.2s;}
    input:checked+.tog-sl{background:#28a745;}
    input:checked+.tog-sl:before{transform:translateX(14px);}
    .save-bar{background:#f9fafb;border-top:1px solid #f3f4f6;padding:8px 16px;display:flex;gap:7px;justify-content:flex-end;}
    .btn-save{padding:6px 16px;background:#28a745;color:#fff;border:none;border-radius:5px;font-size:11px;font-weight:600;cursor:pointer;}
    .btn-save:hover{background:#218838;}
    .btn-cancel{padding:6px 12px;background:#fff;color:#374151;border:1px solid #e5e7eb;border-radius:5px;font-size:11px;cursor:pointer;}
    .alert-s{background:#d1fae5;border:1px solid #a7f3d0;color:#065f46;padding:7px 10px;border-radius:5px;font-size:10px;margin-bottom:8px;display:flex;align-items:center;gap:5px;}
    .alert-e{background:#fee2e2;border:1px solid #fca5a5;color:#991b1b;padding:7px 10px;border-radius:5px;font-size:10px;margin-bottom:8px;display:flex;align-items:center;gap:5px;}
</style>{% endblock %}

{% block sidebar_menu %}{% include 'dashboards/sidebars/admin_sidebar.html' %}{% endblock %}

{% block page_content %}
<div class="page-header" style="margin-bottom:12px;">
    <h1 class="page-title" style="font-size:17px;">Paramètres Système</h1>
    <p class="page-subtitle" style="font-size:11px;">Configuration globale · LONAB — MUTRALO</p>
</div>

{% if messages %}
    {% for msg in messages %}
        <div class="alert-{% if msg.tags == 'success' %}s{% else %}e{% endif %}">
            <i class="fas fa-{% if msg.tags == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>{{ msg }}
        </div>
    {% endfor %}
{% endif %}

<form method="post">
    {% csrf_token %}

    <!-- Tickets -->
    <div class="dc">
        <div class="dc-head"><i class="fas fa-ticket-alt"></i> Tickets &amp; Transactions</div>
        <div class="dc-body">
            <div class="sg">
                <div>
                    <label class="fl">Tickets min. par transaction</label>
                    <input type="number" name="tickets_min_par_transaction" class="fc" min="1" value="{{ params.tickets_min_par_transaction|default:1 }}">
                    <div class="fh">Minimum par commande</div>
                </div>
                <div>
                    <label class="fl">Tickets max. par transaction</label>
                    <input type="number" name="tickets_max_par_transaction" class="fc" min="1" value="{{ params.tickets_max_par_transaction|default:20 }}">
                    <div class="fh">Maximum par commande</div>
                </div>
                <div>
                    <label class="fl">Transactions max. par mois</label>
                    <input type="number" name="transactions_max_par_mois" class="fc" min="1" value="{{ params.transactions_max_par_mois|default:1 }}">
                    <div class="fh">Par client par mois</div>
                </div>
                <div>
                    <label class="fl">Durée validité QR (minutes)</label>
                    <input type="number" name="duree_validite_qr_code_minutes" class="fc" min="1" value="{{ params.duree_validite_qr_code_minutes|default:3 }}">
                    <div class="fh">Avant expiration du QR code</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarification -->
    <div class="dc">
        <div class="dc-head"><i class="fas fa-coins"></i> Tarification</div>
        <div class="dc-body">
            <div class="sg3">
                <div>
                    <label class="fl">Prix ticket (FCFA)</label>
                    <input type="number" name="prix_ticket" class="fc" min="0" step="50" value="{{ params.prix_ticket|default:500 }}">
                    <div class="fh">Payé par l'employé</div>
                </div>
                <div>
                    <label class="fl">Prix repas complet (FCFA)</label>
                    <input type="number" name="prix_repas_complet" class="fc" min="0" step="50" value="{{ params.prix_repas_complet|default:2000 }}">
                    <div class="fh">Coût total du repas</div>
                </div>
                <div>
                    <label class="fl">Subvention MUTRALO (FCFA)</label>
                    <input type="number" name="subvention_ticket" class="fc" min="0" step="50" value="{{ params.subvention_ticket|default:1500 }}">
                    <div class="fh">ticket + subvention = repas</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="dc">
        <div class="dc-head"><i class="fas fa-bell"></i> Notifications</div>
        <div class="dc-body">
            <div class="tog-row">
                <div>
                    <div class="tog-l">Notifications d'achat</div>
                    <div class="tog-s">Envoyer une notif lors de chaque achat</div>
                </div>
                <label class="tog">
                    <input type="checkbox" name="envoyer_notifications_achat" {% if params.envoyer_notifications_achat %}checked{% endif %}>
                    <span class="tog-sl"></span>
                </label>
            </div>
            <div class="tog-row">
                <div>
                    <div class="tog-l">Notifications de consommation</div>
                    <div class="tog-s">Notif quand un ticket est consommé</div>
                </div>
                <label class="tog">
                    <input type="checkbox" name="envoyer_notifications_consommation" {% if params.envoyer_notifications_consommation %}checked{% endif %}>
                    <span class="tog-sl"></span>
                </label>
            </div>
            <div class="tog-row">
                <div>
                    <div class="tog-l">Notifications de programmation</div>
                    <div class="tog-s">Alerte lors d'une nouvelle programmation restaurant</div>
                </div>
                <label class="tog">
                    <input type="checkbox" name="envoyer_notifications_programmation" {% if params.envoyer_notifications_programmation %}checked{% endif %}>
                    <span class="tog-sl"></span>
                </label>
            </div>
            <div class="tog-row">
                <div>
                    <div class="tog-l">Notifications de menu</div>
                    <div class="tog-s">Alerte les clients quand le menu du jour est prêt</div>
                </div>
                <label class="tog">
                    <input type="checkbox" name="envoyer_notifications_menu" {% if params.envoyer_notifications_menu %}checked{% endif %}>
                    <span class="tog-sl"></span>
                </label>
            </div>
            <div style="margin-top:10px;">
                <label class="fl">Email expéditeur</label>
                <input type="email" name="email_notifications_expediteur" class="fc" value="{{ params.email_notifications_expediteur|default:'noreply@lonab.com' }}" style="max-width:280px;">
            </div>
        </div>
    </div>

    <!-- Entreprise -->
    <div class="dc">
        <div class="dc-head"><i class="fas fa-building"></i> Informations entreprise</div>
        <div class="dc-body">
            <div class="sg">
                <div>
                    <label class="fl">Nom de l'entreprise</label>
                    <input type="text" name="nom_entreprise" class="fc" value="{{ params.nom_entreprise|default:'LONAB' }}">
                </div>
                <div>
                    <label class="fl">Nom de la mutuelle</label>
                    <input type="text" name="nom_mutuelle" class="fc" value="{{ params.nom_mutuelle|default:'MUTRALO' }}">
                </div>
                <div>
                    <label class="fl">Email support</label>
                    <input type="email" name="email_support" class="fc" value="{{ params.email_support|default:'support@lonab.com' }}">
                </div>
                <div>
                    <label class="fl">Téléphone support</label>
                    <input type="text" name="telephone_support" class="fc" value="{{ params.telephone_support|default:'' }}">
                </div>
            </div>
        </div>
    </div>

    <!-- Maintenance -->
    <div class="dc">
        <div class="dc-head" {% if params.mode_maintenance %}style="color:#dc3545;"{% endif %}>
            <i class="fas fa-wrench" {% if params.mode_maintenance %}style="color:#dc3545;"{% endif %}></i>
            Mode maintenance {% if params.mode_maintenance %}<span style="color:#dc3545;font-size:9px;background:#fee2e2;padding:1px 6px;border-radius:8px;margin-left:4px;">ACTIF</span>{% endif %}
        </div>
        <div class="dc-body">
            <div class="tog-row" style="margin-bottom:10px;">
                <div>
                    <div class="tog-l" {% if params.mode_maintenance %}style="color:#dc3545;"{% endif %}>Activer le mode maintenance</div>
                    <div class="tog-s">Restreint l'accès aux utilisateurs non-admin</div>
                </div>
                <label class="tog">
                    <input type="checkbox" name="mode_maintenance" {% if params.mode_maintenance %}checked{% endif %}>
                    <span class="tog-sl" {% if params.mode_maintenance %}style="background:#dc3545;"{% endif %}></span>
                </label>
            </div>
            <div>
                <label class="fl">Message affiché en maintenance</label>
                <textarea name="message_maintenance" class="fc" rows="2" placeholder="Maintenance en cours. Merci de revenir ultérieurement.">{{ params.message_maintenance|default:'' }}</textarea>
            </div>
        </div>
        <div class="save-bar">
            <button type="button" class="btn-cancel" onclick="history.back()">Annuler</button>
            <button type="submit" class="btn-save"><i class="fas fa-save"></i> Enregistrer les paramètres</button>
        </div>
    </div>

</form>
{% endblock %}